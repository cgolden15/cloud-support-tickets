<div class="py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-bar-chart"></i> Admin Dashboard</h2>
    </div>
    
    <!-- Statistics Overview -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-info text-white h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4><%= users.length %></h4>
                            <p class="mb-0">Total Users</p>
                        </div>
                        <div class="align-self-center">
                            <i class="bi bi-people-fill" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card bg-primary text-white h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4><%= tickets.length %></h4>
                            <p class="mb-0">Total Tickets</p>
                        </div>
                        <div class="align-self-center">
                            <i class="bi bi-ticket-fill" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card bg-warning text-white h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4><%= stats.byStatus.open + stats.byStatus.in_progress || 0 %></h4>
                            <p class="mb-0">Active Tickets</p>
                        </div>
                        <div class="align-self-center">
                            <i class="bi bi-clock-fill" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card bg-success text-white h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4><%= users.filter(u => u.active === 1).length %></h4>
                            <p class="mb-0">Active Users</p>
                        </div>
                        <div class="align-self-center">
                            <i class="bi bi-person-check-fill" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <a href="/admin/users" class="btn btn-outline-primary w-100 mb-2">
                                <i class="bi bi-people"></i><br>
                                Manage Users
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="/tickets/list" class="btn btn-outline-success w-100 mb-2">
                                <i class="bi bi-list-ul"></i><br>
                                View All Tickets
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="/tickets/list?status=open" class="btn btn-outline-warning w-100 mb-2">
                                <i class="bi bi-circle"></i><br>
                                Open Tickets
                            </a>
                        </div>
                        <div class="col-md-3">
                            <a href="/admin/profile" class="btn btn-outline-info w-100 mb-2">
                                <i class="bi bi-person-gear"></i><br>
                                My Profile
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- User Roles Breakdown -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">User Roles</h5>
                </div>
                <div class="card-body">
                    <% 
                    const roleStats = users.reduce((acc, user) => {
                        if (user.active === 1) {
                            acc[user.role] = (acc[user.role] || 0) + 1;
                        }
                        return acc;
                    }, {});
                    %>
                    <div class="row text-center">
                        <div class="col-4">
                            <h4 class="text-danger"><%= roleStats.super_admin || 0 %></h4>
                            <p class="mb-0">Super Admins</p>
                        </div>
                        <div class="col-4">
                            <h4 class="text-warning"><%= roleStats.admin || 0 %></h4>
                            <p class="mb-0">Admins</p>
                        </div>
                        <div class="col-4">
                            <h4 class="text-info"><%= roleStats.staff || 0 %></h4>
                            <p class="mb-0">Staff</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Ticket Priority Distribution</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-3">
                            <h4 class="text-danger"><%= stats.byPriority.urgent || 0 %></h4>
                            <p class="mb-0">Urgent</p>
                        </div>
                        <div class="col-3">
                            <h4 class="text-danger"><%= stats.byPriority.high || 0 %></h4>
                            <p class="mb-0">High</p>
                        </div>
                        <div class="col-3">
                            <h4 class="text-warning"><%= stats.byPriority.medium || 0 %></h4>
                            <p class="mb-0">Medium</p>
                        </div>
                        <div class="col-3">
                            <h4 class="text-success"><%= stats.byPriority.low || 0 %></h4>
                            <p class="mb-0">Low</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recent Activity -->
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">Recent Users</h5>
                    <a href="/admin/users" class="btn btn-sm btn-outline-primary">View All</a>
                </div>
                <div class="card-body">
                    <% if (users.slice(0, 5).length === 0) { %>
                        <p class="text-muted">No users found</p>
                    <% } else { %>
                        <div class="list-group list-group-flush">
                            <% users.slice(0, 5).forEach(user => { %>
                                <div class="list-group-item px-0">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong><%= user.first_name %> <%= user.last_name %></strong>
                                            <div class="text-muted small">
                                                <%= user.username %> â€¢ <%= user.email %>
                                            </div>
                                        </div>
                                        <div class="text-end">
                                            <span class="badge bg-<%= user.role === 'super_admin' ? 'danger' : user.role === 'admin' ? 'warning' : 'info' %>">
                                                <%= user.role.replace('_', ' ').toUpperCase() %>
                                            </span>
                                            <% if (user.active === 0) { %>
                                                <span class="badge bg-secondary">Inactive</span>
                                            <% } %>
                                        </div>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">Recent Tickets</h5>
                    <a href="/tickets/list" class="btn btn-sm btn-outline-primary">View All</a>
                </div>
                <div class="card-body">
                    <% if (tickets.slice(0, 5).length === 0) { %>
                        <p class="text-muted">No tickets found</p>
                    <% } else { %>
                        <div class="list-group list-group-flush">
                            <% tickets.slice(0, 5).forEach(ticket => { %>
                                <div class="list-group-item px-0">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <a href="/tickets/<%= ticket.id %>" class="text-decoration-none">
                                                <strong>#<%= ticket.id %>: <%= ticket.title.substring(0, 40) %><%= ticket.title.length > 40 ? '...' : '' %></strong>
                                            </a>
                                            <div class="text-muted small">
                                                <%= ticket.submitter_name %> â€¢ <%= new Date(ticket.created_at).toLocaleDateString() %>
                                            </div>
                                        </div>
                                        <div class="text-end">
                                            <span class="badge bg-<%= ticket.status === 'open' ? 'primary' : ticket.status === 'in_progress' ? 'warning' : ticket.status === 'resolved' ? 'success' : 'secondary' %>">
                                                <%= ticket.status.replace('_', ' ').toUpperCase() %>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
</div>